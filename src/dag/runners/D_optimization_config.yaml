# ------------------------------------------------------------
# Pipeline D â€” Hyperparameter Optimization Configuration
# ------------------------------------------------------------
# Purpose:
#   Controls hyperparameter search behavior for each ticker
#   using feature datasets generated by Pipeline C.
#
# Scope:
#   - No model artifacts are persisted
#   - Only metrics, params, and trial metadata are logged
# ------------------------------------------------------------

optimization:

  # ----------------------------------------------------------
  # Model
  # ----------------------------------------------------------
  model:
    type: lstm                # lstm | transformer | xgboost
    lookback: 20              # Default static lookback; can be overridden by search_space

  # ----------------------------------------------------------
  # Optimizer backend
  # ----------------------------------------------------------
  optimizer: optuna

  # ----------------------------------------------------------
  # Search budget
  # ----------------------------------------------------------
  n_trials: 8                 # Total trials per ticker
  timeout_sec: null           # Optional wall-clock timeout per ticker
  epochs: 10                  # Max epochs per trial (for DL models)
  batch_size: 64              # Default static batch size; can be overridden by search_space

  # ----------------------------------------------------------
  # Optimization objective
  # ----------------------------------------------------------
  direction: minimize        # maximize | minimize
  primary_metric: rmse       # Must match evaluation metric key returned from objective

  # ----------------------------------------------------------
  # Sampler & pruner (Optuna-native)
  # ----------------------------------------------------------
  sampler:
    name: tpe                # tpe | random | cmaes
    seed: 42

  pruner:
    name: median             # median | none
    n_warmup_steps: 5


  # ----------------------------------------------------------
  # Cross-validation / splitting
  # ----------------------------------------------------------
  validation:
    method: walk_forward     # walk_forward | holdout
    train_ratio: 0.7
    val_ratio: 0.3
    min_train_size: 252      # ~1 trading year
    step_size: 21            # monthly forward step

  # ----------------------------------------------------------
  # Early stopping (trial-level)
  # ----------------------------------------------------------
  early_stopping:
    enabled: true
    patience: 5
    min_delta: 0.0001

  # ----------------------------------------------------------
  # Hyperparameter search space
  # NOTE:
  #   These are *dynamic domains* sampled by Optuna.
  #   Static model params (like model.type) remain outside.
  # ----------------------------------------------------------
  search_space:
    model:
      lookback_window:
        type: int
        low: 20
        high: 100
        step: 10

      hidden_size:
        type: int
        low: 32
        high: 256
        step: 32

      dropout:
        type: float
        low: 0.0
        high: 0.3

    training:
      learning_rate:
        type: float
        low: 0.0001
        high: 0.01
        log: true

  # ----------------------------------------------------------
  # Reproducibility
  # ----------------------------------------------------------
  random_seed: 42
